<% with_podcast ||= false -%>

<li id="<%=h dom_id(review) -%>" class="review <%= cycle('odd','even', :name => 'row_class') -%>">
  <div class="show">
    <div class="headline">
      <%= link_to_podcast(review.episode.podcast) if with_podcast -%>

      <span class="title"><%= link_to_with_icon (@q ? search_excerpt(review.title, @q) : h(review.title)), 
                                                (review.positive ? :thumbs_up : :thumbs_down), 
                                                review_url(:podcast_slug => review.episode.podcast, :id => review.id), :title => 'permalink' -%></span>
      
      <% if @user.nil? -%>
	by <cite><%= link_to_profile review.reviewer -%></cite>
      <% end -%>
    </div>

    <span class="body"><%= @q ? search_excerpt(review.body, @q) : format_with_paragraph_entity(unescape_entities(review.body)) -%></span>

    
    <div class="tools">
      <span class="episode"><%= link_to review.episode.date_title, episode_url(review.episode.podcast, review.episode) -%></span>

      <%= render(:partial => 'reviews/modify_links', :object => review) -%>
      <%= render(:partial => 'reviews/rating_links', :object => review) -%>

      <% unless current_user -%><div class="quick_signin_container after_rating"></div><% end -%>
    </div>
  </div>


  <% form_for review, :url => review_url(:podcast_slug => review.episode.podcast, :id => review.id), :method => :post, :html => {:class => 'edit', :style => 'display: none;'} do |f| -%>
    <%= render :partial => 'reviews/form', :locals => {:f => f, :podcast_slug => review.episode.podcast, :options => { :suffix => "_#{review.id}" }} -%>
  <% end -%>
</li>
