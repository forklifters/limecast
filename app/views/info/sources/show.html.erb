<h1>Source</h1>

<% content_for :pagination do -%>
  <%= link_to "< Newer", info_source_url(@podcast, @newer.episode, @newer) if @newer %> 
  <%= @feed.sources.sorted.index(@source) + 1 %> of <%= @feed.sources.count -%> 
  <%= link_to "Older >", info_source_url(@podcast, @older.episode, @older) if @older %> 
<% end -%>

<%= render :partial => 'info/feeds/info_source_table', :locals => {:options => {:source => @source}} -%>

<table>
  <tr>
    <td class="key">ability</td>
    <td>
      <%= @source.ability -%>
    </td>
  </tr>

  <tr>
    <td class="key">archived</td>
    <td>
      <%= @source.archived -%>
    </td>
  </tr>

  <tr>
    <td class="key">name&nbsp;date</td>
    <td>
      <%= @episode.clean_url -%>
    </td>
  </tr>

  <tr>
    <td class="key">xml&nbsp;date</td>
    <td>
      <%= relative_time @episode.published_at -%>
    </td>
  </tr>

  <tr>
    <td class="key">found&nbsp;date</td>
    <td>
      <%= relative_time @episode.created_at -%>
    </td>
  </tr>

  <tr>
    <td class="key">age</td>
    <td>
      <%= relative_time @episode.created_at -%>
    </td>
  </tr>

  <tr>
    <td class="key">xml&nbsp;age</td>
    <td>
      <%= @source.downloaded_at.blank? ? blankness: relative_time(@source.downloaded_at) -%>
    </td>
  </tr>

  <tr>
    <td class="key">download&nbsp;age</td>
    <td>
      <%= @source.hashed_at.blank? ? blankness : relative_time(@source.hashed_at) -%>
    </td>
  </tr>
</table>


<h2>Media:</h2>
<%= render :partial => "info/sources/info_media", :locals => {:source => @source} %>

<table>
  <tr>
    <td class="key">extension&nbsp;result</td>
    <td>
      <%= non_blank @source.extension -%>
    </td>
  </tr>
  <tr>
    <td class="key">resolution&nbsp;result</td>
    <td>
      <%= non_blank @source.resolution -%>
    </td>
  </tr>
  <tr>
    <td class="key">frame&nbsp;rate&nbsp;result</td>
    <td>
      <%= non_blank @source.framerate -%>
    </td>
  </tr>
  <tr>
    <td class="key">hash&nbsp;result</td>
    <td>
      <%= non_blank @source.sha1hash -%>
    </td>
  </tr>
  <tr>
    <td class="key">download&nbsp;file&nbsp;name&nbsp;result</td>
    <td>
      <%= non_blank @source.file_name -%>
    </td>
  </tr>

  <tr>
    <td class="key">bitrate&nbsp;result</td>
    <td>
      <%= @feed.bitrate == 0 ? blankness : @feed.bitrate.to_bitrate.to_s -%>
    </td>
  </tr>

  <tr>
    <td class="key">size&nbsp;result</td>
    <td>
      <%= non_blank @source.size.to_file_size.to_s -%>
    </td>
  </tr>

  <tr>
    <td class="key">duration&nbsp;result</td>
    <td>
      <%= @episode.duration == 0 ? blankness : @episode.duration.to_duration.to_s -%>
    </td>
  </tr>

  <tr>
    <td class="key">bitrate&nbsp;exact</td>
    <td>
      <%= non_blank @feed.bitrate -%>
    </td>
  </tr>

  <tr>
    <td class="key">size&nbsp;from&nbsp;disk&nbsp;exact</td>
    <td>
      <%= non_blank @source.size_from_disk -%>
    </td>
  </tr>

  <tr>
    <td class="key">size&nbsp;from&nbsp;xml&nbsp;exact</td>
    <td>
      <%= non_blank @source.size_from_xml -%>
    </td>
  </tr>

  <tr>
    <td class="key">duration&nbsp;exact</td>
    <td>
      <%= non_blank @episode.duration -%>
    </td>
  </tr>

  <tr>
    <td class="key">xml&nbsp;size</td>
    <td>
      <%= @source.xml.blank? ? blankness : @source.xml.size -%>
    </td>
  </tr>

  <tr>
    <td class="key">disk&nbsp;size</td>
    <td>
      <%= non_blank @source.size -%>
    </td>
  </tr>

  <tr>
    <td class="key">xml&nbsp;duration</td>
    <td>
      <%= non_blank @episode.duration -%>
    </td>
  </tr>

  <tr>
    <td class="key">ffmpeg&nbsp;duration</td>
    <td>
      <%= non_blank @episode.duration -%>
    </td>
  </tr>

  <tr>
    <td class="key">xml&nbsp;extension&nbsp;exact</td>
    <td>
      <%= non_blank @source.extension -%>
    </td>
  </tr>

  <tr>
    <td class="key">xml&nbsp;type</td>
    <td>
      <%= non_blank @source.type -%>
    </td>
  </tr>

  <tr>
    <td class="key">http&nbsp;extension</td>
    <td>
      <%= non_blank @source.extension -%>
    </td>
  </tr>

  <tr>
    <td class="key">http&nbsp;type</td>
    <td>
      <%= non_blank @source.type -%>
    </td>
  </tr>

  <tr>
    <td class="key">disk&nbsp;extension</td>
    <td>
      <%= non_blank @source.extension -%>
    </td>
  </tr>

  <tr>
    <td class="key">disk&nbsp;type</td>
    <td>
      <%= non_blank @source.type -%>
    </td>
  </tr>

  <tr>
    <td class="key">curl&nbsp;output</td>
    <td>
      <%= @source.curl_info.blank? ? blankness : "<pre>#{@source.curl_info}</pre>" -%>
    </td>
  </tr>

  <tr>
    <td class="key">ffmpeg&nbsp;output</td>
    <td>
      <%= @source.ffmpeg_info.blank? ? blankness : "<pre>#{@source.ffmpeg_info}</pre>" -%>
    </td>
  </tr>

  <!-- <tr>
    <td class="key">Screenshot</td>
    <td>
      <%= link_to(@source.screenshot.url, @source.screenshot.url) -%>
      (<%= FileSize.new(@source.screenshot_file_size.to_i || 0) -%>)
    </td>
  </tr>
  
  <tr>
    <td class="key">Preview</td>
    <td>
      <%= link_to(@source.preview.url, @source.preview.url) -%>
      (<%= FileSize.new(@source.preview_file_size.to_i || 0) -%>)
    </td>
  </tr>
  -->
</table>

<h2>Preview</h2>
<table>
  <tr>
    <td class="key">preview</td>
    <td>
    <% if @episode.audio_source -%>
      <%= render :partial => 'episodes/audio_player', :object => @episode %>
    <% else -%>
      <%= render :partial => 'episodes/video_player', :object => @episode -%>
    <% end -%>
    </td>
  </tr>

  <tr>
    <td class="key">video still</td>
    <td>
    <%- if @source.screenshot? -%>
      <%= image_tag(@source.screenshot.url, {:rel => @source.preview.url, :alt => "#{@episode.title} cover art"}.merge(scaled_resolution(:width => @source.width, :height => @source.height))) -%>
    <%- else -%>
       <%= image_tag('/imgs/video_placeholder.png', :alt => "#{@episode.title} cover art is missing", :width => 460) -%>
    <%- end -%>
    </td>
  </tr>

  <tr>
    <td class="key">video&nbsp;preview</td>
    <td>
      <%= link_to(@source.preview.url, @source.preview.url) -%>
      (<%= FileSize.new(@source.preview_file_size.to_i || 0) -%>)
    </td>
  </tr>
</table>

<h2>Text</h2>
<table>
  <tr>
    <td class="key">itunes</td>
    <td>
      <%= non_blank @feed.itunes_link %>
    </td>
  </tr>

  <tr>
    <td class="key">title</td>
    <td>
      <%= non_blank @episode.title %>
    </td>
  </tr>

  <tr>
    <td class="key">line&nbsp;description</td>
    <td>
      <%= non_blank format_with_paragraph_entity(sanitize_condensed_summary(@episode.summary)) %>
    </td>
  </tr>

  <tr>
    <td class="key">safe&nbsp;description</td>
    <td>
      <%= non_blank unescape_entities(@episode.summary) %>
    </td>
  </tr>

  <tr>
    <td class="key">page&nbsp;description</td>
    <td>
      <%= non_blank sanitize_summary @episode.summary %>
    </td>
  </tr>

  <tr>
    <td class="key">html&nbsp;description</td>
    <td>
      <%= non_blank sanitize_lightly @episode.summary %>
    </td>
  </tr>
</table>


<h2>Media:</h2>
<%= render :partial => "info/sources/info_media", :locals => {:source => @source} %>

<h2>Badges:</h2>
<ul>
<%- @source.feed.podcast.tags.badges.each do |t| -%>
  <li><%= t.name %></li>
<%- end -%>
</ul>

<h2>XML:</h2
<% if @source.xml.blank? %>
  <%= blankness -%>
<% else %>
  <pre class="formatted-xml"><%= @source.xml -%></pre>
<% end %>
