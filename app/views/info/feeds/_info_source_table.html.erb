<% options ||= {} -%>
<% podcast = options[:podcast] || 
             (options[:feed].podcast if options[:feed]) ||
             (options[:episode].podcast if options[:episode]) ||
             (options[:source].feed.podcast if options[:source]) -%>
<% feed =    options[:feed] -%>
<% episode = options[:episode] ||
             (options[:source].episode if options[:source])-%>
<% source =  options[:source] -%>

<table>
  <tr>
    <td></td>
    <th><!-- Is this a primary feed? //--></th>
  <% podcast.feeds.each do |f| -%>
    <th><% if f.primary? -%>primary<% end -%></th>
  <% end -%>
  </tr>
  <tr>
    <td></td>
    <th><!-- Link to the original feed url //--></th>
  <% podcast.feeds.each do |f| -%>
    <th><%= link_to "rss", f.url %></th>
  <% end -%>
  </tr>
  <tr>
    <td class="extra"><%= link_to "site", podcast_url(podcast) %></td>
    <th><%= controller.controller_name == "podcasts" ? content_tag(:strong, podcast.title) : link_to(podcast.title, info_podcast_url(podcast)) -%></th>
    <% podcast.feeds.each do |f| -%>
    <th>
      <% if f == feed -%>
        <b>feed<%= f.id -%></b> <%= f.ability -%>
      <% else -%>
        <%= info_feed_link(f) -%><br>
      <% end -%>
    </th>
    <% end -%>
  </tr>
  <% if !feed -%>
    <% (episode ? [episode] : podcast.episodes).each do |e| -%>
      <tr>
        <td class="extra"><%= link_to "site", episode_url(podcast, e) %></td>
        <td>
          <% if e == episode && !source -%>
            <b><%= e.date_title -%></b>
          <% else -%>
            <%= link_to e.date_title, info_episode_url(podcast, e) -%>
          <% end -%>
        </td>

        <% podcast.feeds.each do |f| -%>
          <td>
            <% s = Source.find_by_feed_id_and_episode_id(f.id, e.id) -%>
            <% if s -%>
              <% if s == source -%>
                <b>
                  <%= f.formatted_bitrate -%>
                  <%= f.apparent_format -%>
                  <%= source.ability -%><%= "a" if source.archived? -%>
                </b>
              <% else -%>
                <%= info_source_link(s) -%>
              <% end -%>
            <% end -%>
          </td>
        <% end -%>
      </tr>
    <% end -%>
  <% end -%>

  <!-- all sources that don't have an episode //-->
  <% Source.all(:conditions => ["feed_id IN (?) AND episode_id IS NULL", podcast.feed_ids]).each do |s| -%>
    <tr>
      <td class="extra"></td>
      <td>
        no episode
      </td>
      <% podcast.feeds.each do |f| -%>
        <td><% if s.feed == f -%><%= f.formatted_bitrate -%> <%= f.apparent_format -%> <%= s.ability -%><%= "a" if s.archived? -%><% end -%></td>
      <% end -%>
    </tr>
  <% end -%>

  <!-- pagination //-->
  <% if @content_for_pagination -%>
  <tr>
    <td class="pagination" colspan="<%= podcast.feeds.size + 2 %>"><%= yield :pagination -%></td>
  </tr>
  <% @content_for_pagination = nil # reset this in case there are more content_for()'s -%>
  <% end -%>
</table>
