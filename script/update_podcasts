#!/usr/bin/env ruby
root_path = File.join(File.dirname(__FILE__), '..')
require "#{root_path}/config/environment.rb"

if(ARGV[0])
  podcast = Podcast.find(ARGV[0])
  begin
    puts "Getting episodes for #{podcast.title}"
    PodcastProcessor.process(QueuedFeed.find_by_url(podcast.url))
  rescue Exception => e
    puts "There was a problem: #{e.message}"
  end

  exit
else
  `echo '#{Time.now.to_s}' > LAST_UPDATE_PODCASTS`
end

QueuedFeed.parsed.each do |qf|
  begin
    puts "Getting episodes for #{qf.podcast ? qf.podcast.title : qf.url}"
    PodcastProcessor.process(qf)
  rescue Exception => e
    puts "There was a problem: #{e.message}"
  end
end
