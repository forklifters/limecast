#!/usr/bin/env ruby
root_path = File.join(File.dirname(__FILE__), '..')
require "#{root_path}/config/environment.rb"

if(ARGV[0])
  feed = Feed.find(ARGV[0])
  begin
    puts "Getting episodes for #{feed.podcast.title}"
    FeedProcessor.process(QueuedFeed.find_by_url(feed.url))
  rescue Exception => e
    puts "There was a problem: #{e.message}"
  end

  exit
end

QueuedFeed.parsed.each do |qf|
  begin
    puts "Getting episodes for #{qf.feed.podcast.title}"
    FeedProcessor.process(qf)
  rescue Exception => e
    puts "There was a problem: #{e.message}"
  end
end
